# 程序的机器级表示

## 过程

过程是一种抽象，它提供了一种封装代码的方式，用一组指定的参数和一个可选的返回值实现了某种功能。

## 过程实现的机制

1. 传递控制
2. 传递数据
3. 内存管理

## 数据传送

过程调用可能包括把数据作为参数传递，而从过程返回还有可能包括返回一个值。大部分过程间的数据传送是通过寄存器实现的。通过寄存器最多可传送6个参数值，但是如果需要传递更多的参数，调用过程可以在调用动作之前在自己的栈帧里存储好这些参数。

## 栈上的局部存储

以下情况局部数据必须存放在内存中

1. 寄存器不足够存放所有的本地数据
2. 对一个局部变量使用地址运算符‘&’，因此必须能够为它产生一个地址
3. 某些局部变量是数组或结构，因此必须能过通过数组或结构引用被访问到

## 指针的关键原则

1. 每个指针都有一个值，这个值是某个指定类型的对象的地址
2. 指针用‘&’运算符创建，这个运算符可以应用到任何左值类的C表达式上
3. *操作符用于间接引用指针，间接引用是用内存引用实现的，要么是存储到一个指定的地址，要么是从指定的地址读取
4. 数组与指针紧密联系
5. 将指针从一种类型强制转换诚另一种类型，只改变它的类型，而不改变它的值。
6. 指针也可以指向函数

## 函数调用时参数存放位置

一般情况下参数存放在寄存器中，然后传递给函数。局部变量一般也是存储在寄存器中

## 压入和弹出操作

栈向下增长，栈顶元素的地址是所有栈中元素地址最低的，栈指针%rsp保存这栈顶元素的地址

## 压入操作

push %rbp的等价操作为：

1. subq $8,%rsp
2. movq %rbp,(%rsp)



## 弹出操作

popq %rax的等价操作为:

1. movq (%rsp),%rax
2. addq $8,%rsp

## 实现条件分支的两种方法

1. 条件控制
2. 条件传送

## 循环的汇编实现

1. 跳转到中间,先执行一个无条件跳转跳到循环结尾处的测试，以此来执行初始的测试
2. guarded-do，首先用条件分支，如果初始条件不成立就跳过循环，把代码变换为do-while循环

## 结构的汇编实现

C语言的struct实现类似于数组的实现，结构的所有组成部分都存放在内存中一段连续的区域内，，而指向结构的指针就是结构第一个字节的地址。编译器维护关于每个结构类型的信息，指示每个字段的字节偏移。它以这些偏移作为内存引用指令中的位移，从而产生对结构元素的引用。

## 数据对齐原则

任何K字节的基本对象的地址必须是K的倍数





